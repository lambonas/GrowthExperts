---
import { Image } from 'astro:assets';

export interface PortfolioMetrics {
  loadTime?: string;
  mobileScore?: number;
  conversionRate?: string;
}

export interface Props {
  title: string;
  industry: string;
  description: string;
  thumbnailImage: ImageMetadata | string;
  liveUrl?: string;
  metrics?: PortfolioMetrics;
  techStack?: string[];
  featured?: boolean;
  index?: number;
}

const {
  title,
  industry,
  description,
  thumbnailImage,
  liveUrl,
  metrics,
  techStack = [],
  featured = false,
  index = 0,
} = Astro.props;

const isImageMetadata = thumbnailImage && typeof thumbnailImage === 'object' && 'src' in thumbnailImage;
const imageUrl = isImageMetadata ? (thumbnailImage as ImageMetadata).src : thumbnailImage;
---

<article
  class={`portfolio-card group relative bg-white rounded-2xl border border-gray-200 overflow-hidden cursor-pointer transition-all duration-300 hover:border-primary-400 hover:shadow-2xl ${featured ? 'ring-2 ring-primary-500' : ''}`}
  role="button"
  tabindex="0"
  aria-label={`View portfolio item: ${title}`}
  data-portfolio-card
  data-index={index}
  data-title={title}
  data-industry={industry}
  data-description={description}
  data-image={imageUrl}
  data-live-url={liveUrl || ''}
  data-load-time={metrics?.loadTime || ''}
  data-mobile-score={metrics?.mobileScore || ''}
  data-conversion-rate={metrics?.conversionRate || ''}
  data-tech-stack={techStack.join(',')}
>

  {/* Featured Badge - Always visible */}
  {featured && (
    <div class="absolute top-3 left-3 z-20">
      <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-primary-600 text-white shadow-lg">
        Featured
      </span>
    </div>
  )}

  {/* Image Container - Larger 4:3 Aspect Ratio */}
  <div class="relative aspect-[4/3] overflow-hidden bg-gray-100">
    {isImageMetadata ? (
      <Image
        src={thumbnailImage as ImageMetadata}
        alt={`Screenshot of ${title} website homepage`}
        class="portfolio-image w-full h-full object-cover object-top transition-transform duration-500 ease-out group-hover:scale-105"
        loading="lazy"
        widths={[400, 600, 800, 1200]}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
        format="webp"
        quality={85}
      />
    ) : (
      <img
        src={thumbnailImage as string}
        alt={`Screenshot of ${title} website homepage`}
        class="portfolio-image w-full h-full object-cover object-top transition-transform duration-500 ease-out group-hover:scale-105"
        loading="lazy"
      />
    )}

    {/* Desktop Hover Overlay */}
    <div class="portfolio-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none hidden md:flex flex-col justify-end">
      {/* Gradient Background */}
      <div class="absolute inset-0 bg-gradient-to-t from-gray-900/95 via-gray-900/60 to-transparent"></div>

      {/* Industry Badge - Top Right */}
      <div class="absolute top-3 right-3">
        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-white/90 backdrop-blur-sm text-gray-700 shadow-sm">
          {industry}
        </span>
      </div>

      {/* Content - Bottom */}
      <div class="relative z-10 p-5 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-350 ease-out delay-100">
        <h3 class="text-lg font-bold text-white mb-1.5 leading-tight">
          {title}
        </h3>
        <p class="text-gray-200 text-sm leading-relaxed line-clamp-2 mb-3">
          {description}
        </p>

        {/* Metrics Row */}
        {metrics && (
          <div class="flex flex-wrap gap-2 mb-4">
            {metrics.loadTime && (
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-white/20 backdrop-blur-sm text-white">
                <svg class="w-3 h-3 mr-1 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                {metrics.loadTime}
              </span>
            )}
            {metrics.mobileScore && (
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-white/20 backdrop-blur-sm text-white">
                <svg class="w-3 h-3 mr-1 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
                {metrics.mobileScore}/100
              </span>
            )}
            {metrics.conversionRate && (
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-white/20 backdrop-blur-sm text-white">
                <svg class="w-3 h-3 mr-1 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                {metrics.conversionRate}
              </span>
            )}
          </div>
        )}

        {/* Action Buttons */}
        <div class="flex items-center gap-3 pointer-events-auto">
          <button
            type="button"
            class="inline-flex items-center px-4 py-2 bg-white text-gray-900 text-sm font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors"
            data-enlarge-btn
          >
            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
            </svg>
            View Details
          </button>
          {liveUrl && liveUrl !== '#' && (
            <a
              href={liveUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center px-3 py-2 bg-white/20 backdrop-blur-sm text-white text-sm font-medium rounded-lg hover:bg-white/30 transition-colors"
              onclick="event.stopPropagation();"
            >
              Visit Site
              <svg class="w-3.5 h-3.5 ml-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </a>
          )}
        </div>
      </div>
    </div>
  </div>

  {/* Mobile Info Strip - Always Visible */}
  <div class="md:hidden p-4 bg-white border-t border-gray-100">
    <div class="flex items-center justify-between">
      <div class="flex-1 min-w-0">
        <h3 class="text-base font-semibold text-gray-900 truncate">{title}</h3>
        <p class="text-xs text-gray-500 mt-0.5">Tap to view details</p>
      </div>
      <span class="flex-shrink-0 ml-3 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600">
        {industry}
      </span>
    </div>
  </div>
</article>

<style>
  .portfolio-card {
    background: #ffffff;
  }

  .portfolio-card:hover {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
  }

  .portfolio-card:focus-visible {
    outline: 3px solid rgb(var(--color-primary-500));
    outline-offset: 2px;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Smooth transition for content slide-up */
  .portfolio-overlay > div:last-child {
    transition: transform 350ms ease-out;
    transition-delay: 100ms;
  }

  @media (prefers-reduced-motion: reduce) {
    .portfolio-card,
    .portfolio-image,
    .portfolio-overlay,
    .portfolio-overlay * {
      transition: none !important;
      transform: none !important;
    }

    .portfolio-card:hover .portfolio-overlay {
      opacity: 1;
    }
  }
</style>
