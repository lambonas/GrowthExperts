---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import Button from '../components/ui/Button.astro';
import ReviewsMarquee from '../components/ui/ReviewsMarquee.astro';

const pageTitle = 'Contact Us | Digital Growth Experts';
const pageDescription =
  'Ready to grow your business? Contact Digital Growth Experts for SEO services or website design. No obligation, just honest insights. Response within 24 hours.';
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  schema={{
    type: 'LocalBusiness',
    data: {
      '@type': 'LocalBusiness',
      name: 'Digital Growth Experts',
      description: pageDescription,
      url: 'https://growthexperts.com.au/contact/',
      telephone: '+61281128010',
      email: 'Info@growthexperts.com.au',
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Level 1 Suite 1/443 Chapel Rd',
        addressLocality: 'Bankstown',
        addressRegion: 'NSW',
        postalCode: '2200',
        addressCountry: 'AU',
      },
      areaServed: 'Australia',
      priceRange: '$$',
    },
  }}
>
  <Header />

  <main id="main-content">
    <!-- Hero Section with Form -->
    <section class="relative overflow-hidden bg-gradient-hero pt-20 pb-16 md:pt-28 md:pb-24">
      <!-- Background decoration -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-96 h-96 bg-primary-300 rounded-full opacity-20 blur-3xl"></div>
        <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-secondary-300 rounded-full opacity-20 blur-3xl"></div>
      </div>

      <div class="container-custom relative z-10">
        <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-start">
          <!-- Left Column: Form (Mobile First) -->
          <div class="order-1 lg:order-1">
            <div class="mb-6">
              <!-- Breadcrumb -->
              <nav class="text-sm text-gray-600 mb-4">
                <a href="/" class="hover:text-primary-600">Home</a>
                <span class="mx-2">/</span>
                <span class="text-gray-900 font-semibold">Contact</span>
              </nav>

              <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold font-display text-gray-900 mb-4 leading-tight">
                Let's Grow Your Business <span class="text-gradient-trust">Together</span>
              </h1>
            </div>

            <!-- Contact Form - Simplified -->
            <div class="bg-white p-8 rounded-2xl shadow-xl border-2 border-primary-100">
              <h2 class="text-2xl font-bold font-display text-gray-900 mb-2">Get Your Free Strategy Call</h2>
              <p class="text-gray-600 mb-6">Tell us about your business and we'll show you exactly how to get more customers online. Takes 30 seconds.</p>

              <form id="contact-form-enhanced" action="https://formspree.io/f/mdkyevdb" method="POST" class="space-y-4">
                <!-- Service Selector -->
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">
                    What can we help you with? <span class="text-red-500">*</span>
                  </label>
                  <div class="grid grid-cols-2 gap-3" role="radiogroup" aria-label="Service selection">
                    <label class="service-option relative cursor-pointer group" style="touch-action: manipulation; -webkit-tap-highlight-color: transparent;">
                      <input
                        type="radio"
                        name="service"
                        value="SEO"
                        class="sr-only peer"
                        required
                      />
                      <div class="flex items-center justify-center p-4 border-2 border-gray-200 rounded-lg peer-checked:border-primary-500 peer-checked:bg-primary-50 hover:border-primary-300 transition-all">
                        <div class="text-center">
                          <svg class="w-6 h-6 mx-auto mb-1 text-gray-500 group-has-[:checked]:text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                          </svg>
                          <span class="font-semibold text-gray-700 group-has-[:checked]:text-primary-700">SEO</span>
                        </div>
                      </div>
                    </label>
                    <label class="service-option relative cursor-pointer group" style="touch-action: manipulation; -webkit-tap-highlight-color: transparent;">
                      <input
                        type="radio"
                        name="service"
                        value="Website Design"
                        class="sr-only peer"
                      />
                      <div class="flex items-center justify-center p-4 border-2 border-gray-200 rounded-lg peer-checked:border-primary-500 peer-checked:bg-primary-50 hover:border-primary-300 transition-all">
                        <div class="text-center">
                          <svg class="w-6 h-6 mx-auto mb-1 text-gray-500 group-has-[:checked]:text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                          <span class="font-semibold text-gray-700 group-has-[:checked]:text-primary-700">Website Design</span>
                        </div>
                      </div>
                    </label>
                  </div>
                </div>

                <!-- Conditional: SEO Fields -->
                <div id="seo-fields" class="hidden transition-all duration-300" aria-hidden="true">
                  <label for="website" class="block text-sm font-semibold text-gray-700 mb-2">
                    Website URL <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    id="website"
                    name="website"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors"
                    placeholder="yourwebsite.com.au"
                  />
                </div>

                <!-- Conditional: Website Design Fields -->
                <div id="design-fields" class="hidden transition-all duration-300" aria-hidden="true">
                  <label for="business_type" class="block text-sm font-semibold text-gray-700 mb-2">
                    Business Type / Industry <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    id="business_type"
                    name="business_type"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors"
                    placeholder="e.g. Restaurant, Plumber, Real Estate"
                  />
                </div>

                <!-- Name -->
                <div>
                  <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                    Full Name <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors"
                    placeholder="John Smith"
                  />
                </div>

                <!-- Phone -->
                <div>
                  <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
                    Phone Number <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors"
                    placeholder="+61 XXX XXX XXX"
                  />
                </div>

                <!-- Formspree hidden field to set custom subject -->
                <input type="hidden" id="form-subject" name="_subject" value="New Inquiry from Website" />

                <!-- Submit Button -->
                <button
                  type="submit"
                  id="submit-button"
                  class="w-full bg-accent-500 hover:bg-accent-600 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
                >
                  Get My Free Strategy Call →
                </button>

                <!-- Microcopy / Risk Reducer -->
                <p class="text-center text-sm text-gray-500 mt-3 flex items-center justify-center gap-1">
                  <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                  No spam. No hard sell. Just honest advice.
                </p>
              </form>

              <!-- Success/Error Messages -->
              <div id="form-feedback" class="hidden mt-4 p-4 rounded-lg" role="alert" aria-live="polite"></div>
            </div>
          </div>

          <!-- Right Column: Reviews & Contact Details -->
          <div class="order-2 lg:order-2 space-y-8">
            <!-- Auto-scrolling Google Reviews -->
            <ReviewsMarquee />

            <!-- Contact Details -->
            <div class="bg-white p-8 rounded-2xl shadow-xl border-2 border-primary-100">
              <h3 class="text-2xl font-bold font-display text-gray-900 mb-6">Get In Touch</h3>

              <div class="space-y-6">
                <!-- Phone - Primary CTA with accent highlight -->
                <div class="flex items-start space-x-4 group">
                  <div class="w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center flex-shrink-0 shadow-md group-hover:shadow-lg transition-shadow">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-700 text-sm uppercase tracking-wide mb-1">Phone</div>
                    <a href="tel:+61281128010" class="text-accent-600 hover:text-accent-700 font-medium transition-colors">
                      (02) 8112 8010
                    </a>
                    <p class="text-sm text-gray-600 mt-1">Mon-Fri 9AM-6PM AEST</p>
                  </div>
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-200"></div>

                <!-- Email -->
                <div class="flex items-start space-x-4 group">
                  <div class="w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center flex-shrink-0 shadow-md group-hover:shadow-lg transition-shadow">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                      <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-700 text-sm uppercase tracking-wide mb-1">Email</div>
                    <a href="mailto:Info@growthexperts.com.au" class="text-primary-600 hover:text-primary-700 font-medium break-all transition-colors">
                      Info@growthexperts.com.au
                    </a>
                    <p class="text-sm text-gray-600 mt-1">We respond within 24 hours</p>
                  </div>
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-200"></div>

                <!-- Location -->
                <div class="flex items-start space-x-4 group">
                  <div class="w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center flex-shrink-0 shadow-md group-hover:shadow-lg transition-shadow">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-700 text-sm uppercase tracking-wide mb-1">Location</div>
                    <p class="text-gray-900 font-medium">Sydney, NSW</p>
                    <p class="text-sm text-gray-600 mt-1">Australian-Based Team</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ Quick Hits -->
    <section class="section-padding bg-gray-50">
      <div class="container-custom">
        <div class="text-center max-w-3xl mx-auto mb-12">
          <h2 class="text-3xl md:text-4xl font-bold font-display text-gray-900 mb-4">
            Common Questions Before You Reach Out
          </h2>
        </div>

        <div class="max-w-3xl mx-auto space-y-4">
          <!-- FAQ Item 1 -->
          <details class="group bg-white rounded-lg shadow-md border-2 border-gray-100 hover:border-primary-200 transition-colors">
            <summary class="flex items-center justify-between p-6 cursor-pointer">
              <h3 class="text-lg font-semibold font-display text-gray-900 group-hover:text-primary-600">
                Is the audit really free?
              </h3>
              <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-6 pb-6 text-gray-600 leading-relaxed">
              <p>Yes, absolutely! Our SEO audit is completely free with no strings attached. We provide genuine value upfront because we're confident in our ability to help you grow.</p>
            </div>
          </details>

          <!-- FAQ Item 2 -->
          <details class="group bg-white rounded-lg shadow-md border-2 border-gray-100 hover:border-primary-200 transition-colors">
            <summary class="flex items-center justify-between p-6 cursor-pointer">
              <h3 class="text-lg font-semibold font-display text-gray-900 group-hover:text-primary-600">
                Do I need to commit to anything?
              </h3>
              <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-6 pb-6 text-gray-600 leading-relaxed">
              <p>Not at all. The audit is no-obligation. We'll provide you with actionable insights, and if you'd like our help implementing them, we can discuss that. No pressure, no long-term contracts.</p>
            </div>
          </details>

          <!-- FAQ Item 3 -->
          <details class="group bg-white rounded-lg shadow-md border-2 border-gray-100 hover:border-primary-200 transition-colors">
            <summary class="flex items-center justify-between p-6 cursor-pointer">
              <h3 class="text-lg font-semibold font-display text-gray-900 group-hover:text-primary-600">
                How long does it take?
              </h3>
              <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-6 pb-6 text-gray-600 leading-relaxed">
              <p>We'll respond within 24 hours and deliver your comprehensive audit within 48 hours. We believe in moving fast so you can start improving your SEO sooner.</p>
            </div>
          </details>

          <!-- FAQ Item 4 -->
          <details class="group bg-white rounded-lg shadow-md border-2 border-gray-100 hover:border-primary-200 transition-colors">
            <summary class="flex items-center justify-between p-6 cursor-pointer">
              <h3 class="text-lg font-semibold font-display text-gray-900 group-hover:text-primary-600">
                What if I'm already working with another agency?
              </h3>
              <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="px-6 pb-6 text-gray-600 leading-relaxed">
              <p>That's fine! Our audit can provide a second opinion and show you if you're getting the results you deserve. Many of our clients came to us from other agencies.</p>
            </div>
          </details>

          <!-- Link to full FAQ -->
          <div class="text-center pt-8">
            <a href="/faq/" class="inline-flex items-center text-primary-600 hover:text-primary-700 font-semibold text-lg">
              View all FAQs
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Final CTA Section -->
    <section class="section-padding bg-gradient-to-br from-primary-600 to-primary-700">
      <div class="container-custom text-center">
        <h2 class="text-3xl md:text-4xl font-bold font-display text-white mb-4">
          Still Have Questions?
        </h2>
        <p class="text-xl text-primary-100 mb-8 max-w-2xl mx-auto">
          We're here to help. No pressure, no obligation.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button variant="accent" size="lg" href="#contact-form-enhanced">
            Send Us a Message
          </Button>
          <a
            href="tel:+61281128010"
            class="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold rounded-lg bg-white text-primary-600 hover:bg-primary-50 transition-all duration-200 hover:shadow-xl"
          >
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
            </svg>
            Call Us Now
          </a>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>

<script is:inline data-astro-rerun>
  // Contact Form Controller
  // Uses data-astro-rerun to force re-execution after View Transitions
  // This ensures radio buttons work properly on mobile after navigation
  (function() {
    // Store handler references on window to clean up on re-runs
    if (!window._contactFormHandlers) {
      window._contactFormHandlers = { radioHandlers: [], submitHandler: null, ctaHandler: null };
    }

    function initContactForm() {
      const form = document.getElementById('contact-form-enhanced');
      if (!form || form.dataset.initialized === 'true') return false;
      form.dataset.initialized = 'true';

      const serviceRadios = document.querySelectorAll('input[name="service"]');

      // Guard: Exit if no service radios found (wrong page or DOM issue)
      if (serviceRadios.length === 0) return false;

      const seoFields = document.getElementById('seo-fields');
      const designFields = document.getElementById('design-fields');
      const websiteInput = document.getElementById('website');
      const businessTypeInput = document.getElementById('business_type');
      const subjectInput = document.getElementById('form-subject');
      const submitButton = document.getElementById('submit-button');
      const feedbackDiv = document.getElementById('form-feedback');

      // Track selected service for success message
      let selectedService = '';

      function updateConditionalFields(service) {
        selectedService = service;

        if (service === 'SEO') {
          if (seoFields) {
            seoFields.classList.remove('hidden');
            seoFields.setAttribute('aria-hidden', 'false');
          }
          if (designFields) {
            designFields.classList.add('hidden');
            designFields.setAttribute('aria-hidden', 'true');
          }
          if (websiteInput) websiteInput.required = true;
          if (businessTypeInput) businessTypeInput.required = false;
          if (subjectInput) subjectInput.value = 'New SEO Audit Request';
          if (submitButton) submitButton.textContent = 'Get My Free SEO Audit →';
        } else if (service === 'Website Design') {
          if (designFields) {
            designFields.classList.remove('hidden');
            designFields.setAttribute('aria-hidden', 'false');
          }
          if (seoFields) {
            seoFields.classList.add('hidden');
            seoFields.setAttribute('aria-hidden', 'true');
          }
          if (websiteInput) websiteInput.required = false;
          if (businessTypeInput) businessTypeInput.required = true;
          if (subjectInput) subjectInput.value = 'New Website Design Inquiry';
          if (submitButton) submitButton.textContent = 'Get My Free Quote →';
        }
      }

      // Service radio change handlers
      serviceRadios.forEach(function(radio) {
        radio.addEventListener('change', function(e) {
          updateConditionalFields(e.target.value);
        });
      });

      // Check if any radio is already checked (e.g., after View Transition or browser restore)
      // This ensures the conditional fields are shown correctly on reinitialization
      const checkedRadio = document.querySelector('input[name="service"]:checked');
      if (checkedRadio) {
        updateConditionalFields(checkedRadio.value);
      }

      // CTA button scroll handler
      const ctaButton = document.querySelector('[href="#contact-form-enhanced"]');
      if (ctaButton) {
        ctaButton.addEventListener('click', function(e) {
          e.preventDefault();
          form.scrollIntoView({ behavior: 'smooth', block: 'center' });
          const firstRadio = form.querySelector('input[name="service"]');
          setTimeout(function() { if (firstRadio) firstRadio.focus(); }, 500);
        });
      }

      // Form submission handler
      if (feedbackDiv) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();

          const originalButtonText = submitButton ? submitButton.textContent : 'Get My Free Strategy Call →';

          if (submitButton) {
            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';
          }

          feedbackDiv.classList.add('hidden');

          try {
            const formData = new FormData(form);

            let websiteValue = formData.get('website');
            if (websiteValue && !websiteValue.match(/^https?:\/\//i)) {
              websiteValue = 'https://' + websiteValue;
              formData.set('website', websiteValue);
            }

            if (!websiteValue) formData.delete('website');
            const businessType = formData.get('business_type');
            if (!businessType) formData.delete('business_type');

            const response = await fetch('https://formspree.io/f/mdkyevdb', {
              method: 'POST',
              body: formData,
              headers: { 'Accept': 'application/json' }
            });

            if (response.ok) {
              const successMessage = selectedService === 'SEO'
                ? "We'll get back to you within 24 hours with your free SEO audit."
                : "We'll contact you within 24 hours to discuss your website design project.";

              feedbackDiv.className = 'mt-4 p-4 rounded-lg bg-green-50 border-2 border-green-200';
              feedbackDiv.innerHTML = `
                <div class="flex items-start">
                  <svg class="w-5 h-5 text-green-600 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <div>
                    <p class="font-semibold text-green-800">Thank you for your message!</p>
                    <p class="text-sm text-green-700 mt-1">${successMessage}</p>
                  </div>
                </div>
              `;
              feedbackDiv.classList.remove('hidden');

              form.reset();
              if (seoFields) {
                seoFields.classList.add('hidden');
                seoFields.setAttribute('aria-hidden', 'true');
              }
              if (designFields) {
                designFields.classList.add('hidden');
                designFields.setAttribute('aria-hidden', 'true');
              }
              if (websiteInput) websiteInput.required = false;
              if (businessTypeInput) businessTypeInput.required = false;
              if (submitButton) submitButton.textContent = 'Get My Free Strategy Call →';
              selectedService = '';

              feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

              setTimeout(function() {
                feedbackDiv.classList.add('hidden');
              }, 10000);
            } else {
              const errorData = await response.json();
              throw new Error(errorData.error || 'Form submission failed');
            }
          } catch (error) {
            feedbackDiv.className = 'mt-4 p-4 rounded-lg bg-red-50 border-2 border-red-200';
            feedbackDiv.innerHTML = `
              <div class="flex items-start">
                <svg class="w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
                <div>
                  <p class="font-semibold text-red-800">Oops! Something went wrong.</p>
                  <p class="text-sm text-red-700 mt-1">Please try again or call us directly at <a href="tel:+61281128010" class="underline font-medium">(02) 8112 8010</a></p>
                </div>
              </div>
            `;
            feedbackDiv.classList.remove('hidden');
            console.error('Form submission error:', error);
          } finally {
            if (submitButton) {
              submitButton.disabled = false;
              submitButton.textContent = originalButtonText;
            }
          }
        });
      }

      return true;
    }

    let initScheduled = false;

    function scheduleInit() {
      if (initScheduled) return;
      initScheduled = true;

      requestAnimationFrame(() => {
        initScheduled = false;

        const didInit = initContactForm();
        if (!didInit) {
          // Retry once after the DOM swap settles
          requestAnimationFrame(initContactForm);
        }
      });
    }

    // Astro-native initialization: bind on page load events
    // This ensures DOM is ready before we try to find form elements
    document.addEventListener('astro:page-load', scheduleInit);

    // Also handle View Transitions swap
    document.addEventListener('astro:after-swap', function() {
      scheduleInit();
    });

    // Initialize immediately as a fallback
    scheduleInit();
  })();
</script>
